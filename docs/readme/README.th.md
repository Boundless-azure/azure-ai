# Xiaolan (ภาพรวมโครงการ · ภาษาไทย)

สลับภาษา: [English](/docs/readme/README.en.md) · [Deutsch](/docs/readme/README.de.md) · [中文](/docs/readme/README.zh-CN.md) · [עברית](/docs/readme/README.he.md) · [ไทย](/docs/readme/README.th.md) · [Deutsch (Österreich)](/docs/readme/README.de-AT.md)

## การวางตำแหน่งและเป้าหมาย

1. ชื่อโครงการ “Xiaolan”.
2. จุดเริ่มต้นการโต้ตอบยุคใหม่: ใช้ AI แทนรูปแบบเว็บแบบคลิกเดิม ให้ผู้ใช้สั่งงานอินเตอร์เฟซหรือจัดการข้อมูลด้วยภาษาธรรมชาติ.
3. ความสามารถเติบโตด้วยตนเอง: AI สร้างปลั๊กอินโค้ดและส่งกลับเข้าระบบ เกิดวงจรความสามารถที่เติบโตอย่างต่อเนื่อง.
4. ข้อจำกัดการสร้าง + ระบบบัสธุรกรรม (HookBus): ทำให้โค้ดที่ AI สร้างมีการพึ่งพาต่ำ/ซ้อนน้อย ควบคุมและตรวจสอบได้ เหมาะสำหรับองค์กร.
5. สเปกการควบคุมคอมโพเนนต์ฝั่งหน้าบ้านโดย AI: ให้ AI ควบคุมคอมโพเนนต์ได้โดยตรง อย่างคาดการณ์ได้และตรวจสอบได้.

## ความคืบหน้า ณ ปัจจุบัน (สิ่งที่ใช้งานได้แล้ว)

- การสนทนาและการสตรีม
  - ไม่สตรีม: `ConversationService.chat()`
  - สตรีม (ลักษณะ SSE): `ConversationService.chatStream()`

- การทำงาน function‑call แบบเนทีฟผ่านบริการ
  - คำอธิบายอยู่ที่ `src/core/function-call/descriptions/`; แต่ละบริการให้ `getHandle()` พร้อม `description/validate/execute`.
  - เลเยอร์สนทนาเพิ่ม `toolDescriptions` ตามบริการที่เปิดใช้งาน (function‑call แบบเนทีฟของโมเดล).

- บริการ function‑call ที่มีให้ใช้
  - `PluginOrchestratorService` → ฟังก์ชัน: `plugin_orchestrate`
    - จุดเริ่มสำหรับ “วางแผนก่อน สร้างภายหลัง”.
    - โมเดลส่งเพียง `input`; ระบบจะเติม `phase/modelId/temperature` ให้ครบ.
  - `MysqlReadonlyService` → ฟังก์ชัน: `db_mysql_select`
    - คิวรีอ่านอย่างเดียว การตรวจสอบ: `params` ต้องเป็นอาร์เรย์ของค่าพื้นฐาน (string/number/boolean/null) และต้องมี `limit`. ผลลัพธ์: `Record<string, unknown>[]`.
  - `ContextFunctionService` → ฟังก์ชัน: `context_window_keyword`
    - รองรับนามแฝง: `context_keyword_window`.

- สวิตช์ลงทะเบียนตามบริการ (แนะนำ)
  - กำหนดค่าได้ที่ `src/app/conversation/conversation.module.ts`.
  - ตัวอย่าง: เปิดเฉพาะ MySQL อ่านอย่างเดียว
    - `includeFunctionServices: [MysqlReadonlyService]`

- โฟลว์การทำงาน (`ConversationService`)
  - ระบุด้วยชื่อ (รองรับนามแฝง) เรียก `validate` แล้ว `execute`.
  - กรณีพิเศษ `plugin_orchestrate`: ระบบเติมพารามิเตอร์ให้ โมเดลส่งเฉพาะ `input`.

- คุณภาพและการทำงานร่วมกัน
  - ตั้งค่า ESLint เพื่อมองข้ามตัวแปรที่ขึ้นต้นด้วยขีดล่างเมื่อไม่ได้ใช้ มีประโยชน์ในบริบท function‑call.
  - เอกสารคำแนะนำโมดูล: `src/core/function-call/module.tip`.

## สเปกการทำงานคอมโพเนนต์หน้าบ้านโดย AI (ภาพรวม)

- การตั้งชื่อแอคชัน: คงที่และสามารถเล่นซ้ำ เช่น `openModal` / `updateTable` / `navigate`.
- การตรวจสอบพารามิเตอร์: กำหนดชนิดและฟิลด์ที่จำเป็น ปฏิเสธพารามิเตอร์ที่มีผลข้างเคียงโดยไม่มีการตรวจสอบ.
- ความเป็นเอกฐาน (Idempotency): รันซ้ำไม่ทำให้สถานะขัดแย้ง รองรับการย้อนกลับเชิงธุรกรรม.
- การหมดเวลาและการลองใหม่: ทุกการทำงานมี timeout การลองใหม่ และ fallback.
- ความปลอดภัยและการตรวจสอบ: บันทึกทุกการทำงานพร้อม snapshot บริบท.
- HookBus: รวมแอคชันฝั่งหน้า/หลังเข้ากับบัส เพื่อคงลำดับและความสอดคล้อง.

## Roadmap / แผนต่อไป

- การรันคำสั่งฐานข้อมูลโดยตรง (การเขียน)
  - จุดเข้า SQL ที่ปลอดภัย: whitelist ตรวจ placeholder และแยกการทำงานที่ละเอียดอ่อน.
  - รวมระบบสิทธิ์: ควบคุมตามบทบาท/ผู้เช่า พร้อมบันทึกการตรวจสอบ.

- ความปลอดภัยและสิทธิ์ของฐานข้อมูล
  - ควบคุมแบบละเอียดระดับ schema/ตาราง/คอลัมน์.
  - การตรวจสอบและจัดการความเสี่ยง พร้อมแจ้งเตือนและย้อนกลับ.

- การสร้างปลั๊กอินอย่างชาญฉลาด (เพิ่มความสามารถเติบโตด้วยตนเอง)
  - วางแผน → สร้าง → ทดสอบ → เผยแพร่.
  - กลยุทธ์จำกัดการสร้าง: ควบคุมจำนวน dependency เวอร์ชัน และไลเซนส์; ลดการซ้อนลึก.

- การสร้างหน้าโดยอิงจากตารางที่มีอยู่
  - สร้างหน้าจอ CRUD อัตโนมัติ พร้อม routing และสิทธิ์.
  - ผสานกับ HookBus/ปลั๊กอิน (เช่น `plugins/customer-analytics`).

## เริ่มต้นใช้งาน (Quick Start)

1) ติดตั้งและบิลด์

```bash
npm install
npm run build
```

2) ตั้งค่าบริการที่เปิดใช้งาน (`includeFunctionServices`)

3) เริ่มเซิร์ฟเวอร์พัฒนา (ถ้ามี)

```bash
npm run start:dev
```

คำแนะนำ: สำหรับการพัฒนา DB ในเครื่อง ดู `docker/mysql/init` และ `.env`. เริ่มต้นให้ใช้ `MysqlReadonlyService` ก่อน; เปิดการเขียนเมื่อระบบสิทธิ์และการตรวจสอบพร้อม.